<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tesla Dashboard v4</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background-color: #000;
      font-family: sans-serif;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      color: white;
    }

    body {
      padding-top: env(safe-area-inset-top);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      padding-bottom: env(safe-area-inset-bottom);
    }

    #map {
      height: 100vh;
      width: 100vw;
      background-color: #000;
    }

    #destination-input {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      width: 300px;
    }

    #destination-input input {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      background: #111;
      color: white;
      outline: none;
      box-shadow: 0 0 10px #000;
    }

    #searchResults {
      max-height: 300px;
      overflow-y: auto;
      background: #111;
      color: white;
      border-radius: 6px;
      display: none;
      margin-top: 4px;
      box-shadow: 0 0 10px #000;
    }

    .search-result {
      padding: 8px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }

    .search-result:hover {
      background: #333;
    }

    #etaDisplay, #stopBtn {
      position: fixed;
      right: 20px;
      z-index: 1001;
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 0 10px #000;
      font-family: monospace;
    }

    #etaDisplay {
      bottom: 60px;
      background: #222;
      display: none;
    }

    #stopBtn {
      bottom: 110px;
      background: #900;
      border: none;
      color: white;
      cursor: pointer;
      display: none;
    }

    #recenterBtn {
      position: absolute;
      bottom: 160px;
      left: 20px;
      z-index: 1001;
      background: #000;
      color: #0f0;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #000;
    }

    #bottom-buttons {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1001;
      box-shadow: 0 -2px 5px #000;
    }

    #bottom-buttons button {
      color: white;
      background: transparent;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    .arrow-icon {
      path: "M 0,-20 L 10,10 L -10,10 Z";
      fill: red;
      stroke: white;
      stroke-width: 2;
      filter: drop-shadow(0 0 2px black);
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="destination-input">
    <input type="text" id="destination" placeholder="Search destination..." autocomplete="off" />
    <div id="searchResults"></div>
  </div>

  <button id="recenterBtn">Recenter</button>
  <button id="stopBtn">Stop</button>
  <div id="etaDisplay">ETA:</div>

  <div id="bottom-buttons">
    <button>Home</button>
    <button>Music</button>
    <button>Navigation</button>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNIMK5n09eQactHuhsqzZomcj-0Gyv_NA&libraries=places"></script>
  <script>
    let map;
    let userMarker;
    let userLocation = null;
    let autoRecenter = false;
    let directionsService;
    let directionsRenderer;
    let isRouting = false;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 15,
        disableDefaultUI: true,
        styles: [ /* dark mode styles omitted for brevity */ ]
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map });

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (position) => {
            userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            if (!userMarker) {
              userMarker = new google.maps.Marker({
                position: userLocation,
                map,
                icon: {
                  path: "M 0,-20 L 12,10 L -12,10 Z",
                  fillColor: "red",
                  fillOpacity: 1,
                  strokeColor: "white",
                  strokeWeight: 2,
                  scale: 1.2,
                  rotation: 0,
                  anchor: new google.maps.Point(0, 0)
                }
              });
              map.setCenter(userLocation);
              autoRecenter = true;
            } else {
              userMarker.setPosition(userLocation);
              if (autoRecenter) map.setCenter(userLocation);
            }
          },
          (err) => {
            console.warn("Geolocation failed:", err);
            alert("Location failed: Please enable location services.");
          },
          { enableHighAccuracy: true, maximumAge: 1000 }
        );
      }

      const input = document.getElementById("destination");
      const searchBox = new google.maps.places.SearchBox(input);
      const resultsDiv = document.getElementById("searchResults");

      input.addEventListener("input", () => {
        resultsDiv.innerHTML = "";
        resultsDiv.style.display = "none";
      });

      searchBox.addListener("places_changed", () => {
        const places = searchBox.getPlaces();
        resultsDiv.innerHTML = "";

        if (!places.length) return;

        places.forEach((place) => {
          if (!place.geometry) return;

          const div = document.createElement("div");
          div.className = "search-result";
          div.textContent = place.name;
          div.onclick = () => {
            input.value = place.name;
            resultsDiv.innerHTML = "";
            resultsDiv.style.display = "none";
            routeTo(place.geometry.location);
          };
          resultsDiv.appendChild(div);
        });

        resultsDiv.style.display = "block";
      });

      document.addEventListener("click", (e) => {
        if (!document.getElementById("destination-input").contains(e.target)) {
          resultsDiv.style.display = "none";
        }
      });

      document.getElementById("recenterBtn").onclick = () => {
        if (userLocation) {
          map.setCenter(userLocation);
          autoRecenter = true;
        }
      };

      document.getElementById("stopBtn").onclick = () => {
        directionsRenderer.set("directions", null);
        document.getElementById("etaDisplay").style.display = "none";
        document.getElementById("stopBtn").style.display = "none";
        isRouting = false;
        map.setHeading(0);
        map.setTilt(0);
      };
    }

    function routeTo(destination) {
      if (!userLocation) {
        alert("Waiting for location...");
        return;
      }

      autoRecenter = false;

      directionsService.route(
        {
          origin: userLocation,
          destination: destination,
          travelMode: "DRIVING",
        },
        (response, status) => {
          if (status === "OK") {
            directionsRenderer.setDirections(response);
            const duration = response.routes[0].legs[0].duration.text;
            document.getElementById("etaDisplay").innerText = "ETA: " + duration;
            document.getElementById("etaDisplay").style.display = "block";
            document.getElementById("stopBtn").style.display = "block";
            isRouting = true;

            map.setHeading(0);
            map.setTilt(45);
          } else {
            alert("Directions failed: " + status);
          }
        }
      );
    }

    window.initMap = initMap;
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNIMK5n09eQactHuhsqzZomcj-0Gyv_NA&libraries=places&callback=initMap"></script>
</body>
</html>
