<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tesla Dashboard v2</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background-color: #000; /* Dark background without breaking map */
    }
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    #destination-input {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
      background: #222;
      padding: 8px;
      border-radius: 6px;
      width: 320px;
      box-shadow: 0 0 10px #000;
    }
    #destination-input input {
      width: 100%;
      padding: 6px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }

    #searchResults {
      max-height: 250px;
      overflow-y: auto;
      background: #111;
      margin-top: 4px;
      border-radius: 6px;
      color: white;
      box-shadow: 0 0 10px #000;
      display: none;
    }

    .search-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }
    .search-result:hover {
      background: #333;
    }
    .search-result button {
      background: #00FF00;
      border: none;
      color: #000;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    #etaDisplay {
      position: fixed;
      bottom: 60px;
      right: 20px;
      background: #222;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      z-index: 1001;
      font-family: monospace;
      display: none;
    }

    #bottom-buttons {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1001;
    }
    #bottom-buttons button {
      color: white;
      background: transparent;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    #stopButton {
      position: fixed;
      bottom: 110px;
      right: 20px;
      background: #ff4444;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      z-index: 1001;
      display: none;
      cursor: pointer;
      font-weight: bold;
    }
  </style>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNIMK5n09eQactHuhsqzZomcj-0Gyv_NA&libraries=places"></script>
</head>
<body>
  <div id="map"></div>

  <div id="destination-input">
    <input type="text" id="destination" placeholder="Search destination..." />
    <div id="searchResults"></div>
  </div>

  <div id="etaDisplay">ETA:</div>
  <div id="stopButton">Stop</div>

  <div id="bottom-buttons">
    <button>Home</button>
    <button>Music</button>
    <button>Navigation</button>
    <button id="recenterBtn">Recenter</button>
  </div>

  <script>
    let map;
    let userMarker;
    let directionsService;
    let directionsRenderer;
    let userLatLng;
    let centerOnUser = true;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 29.7604, lng: -95.3698 }, // fallback center
        zoom: 14,
        styles: [
          { elementType: 'geometry', stylers: [{ color: '#121212' }] },
          { elementType: 'labels.text.stroke', stylers: [{ color: '#121212' }] },
          { elementType: 'labels.text.fill', stylers: [{ color: '#ffffff' }] },
          { featureType: 'administrative', elementType: 'geometry', stylers: [{ color: '#444444' }] },
          { featureType: 'poi', elementType: 'labels.text.fill', stylers: [{ color: '#888888' }] },
          { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#333333' }] },
          { featureType: 'road', elementType: 'geometry.stroke', stylers: [{ color: '#222222' }] },
          { featureType: 'road', elementType: 'labels.text.fill', stylers: [{ color: '#bbbbbb' }] },
          { featureType: 'transit', elementType: 'geometry', stylers: [{ color: '#444444' }] },
          { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#000000' }] }
        ]
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        suppressMarkers: true,
        polylineOptions: { strokeColor: '#00FF00', strokeWeight: 5 }
      });
      directionsRenderer.setMap(map);

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(position => {
          userLatLng = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          if (!userMarker) {
            userMarker = new google.maps.Marker({
              position: userLatLng,
              map: map,
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 8,
                fillColor: '#00FF00',
                fillOpacity: 1,
                strokeWeight: 2,
                strokeColor: '#000'
              }
            });
          } else {
            userMarker.setPosition(userLatLng);
          }
          if (centerOnUser) {
            map.setCenter(userLatLng);
          }
        });
      }

      const input = document.getElementById('destination');
      const searchResults = document.getElementById('searchResults');
      const etaDisplay = document.getElementById('etaDisplay');
      const stopButton = document.getElementById('stopButton');

      const service = new google.maps.places.AutocompleteService();

      input.addEventListener('input', () => {
        const query = input.value;
        if (!query) {
          searchResults.innerHTML = '';
          searchResults.style.display = 'none';
          return;
        }

        service.getPlacePredictions({ input: query }, (predictions, status) => {
          if (status !== google.maps.places.PlacesServiceStatus.OK || !predictions) {
            searchResults.innerHTML = '';
            searchResults.style.display = 'none';
            return;
          }

          searchResults.innerHTML = '';
          predictions.forEach(pred => {
            const div = document.createElement('div');
            div.className = 'search-result';
            const span = document.createElement('span');
            span.textContent = pred.description;
            const btn = document.createElement('button');
            btn.textContent = 'Go';
            btn.onclick = () => {
              input.value = pred.description;
              searchResults.style.display = 'none';
              centerOnUser = false;
              routeTo(pred.place_id);
            };
            div.appendChild(span);
            div.appendChild(btn);
            searchResults.appendChild(div);
          });
          searchResults.style.display = 'block';
        });
      });

      document.addEventListener('click', (e) => {
        if (!document.getElementById('destination-input').contains(e.target)) {
          searchResults.style.display = 'none';
        }
      });

      function routeTo(placeId) {
        const placesService = new google.maps.places.PlacesService(map);
        placesService.getDetails({ placeId }, (place, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            const destination = place.geometry.location;

            directionsService.route({
              origin: userLatLng,
              destination: destination,
              travelMode: 'DRIVING'
            }, (result, status) => {
              if (status === 'OK') {
                directionsRenderer.setDirections(result);
                const duration = result.routes[0].legs[0].duration.text;
                etaDisplay.style.display = 'block';
                etaDisplay.textContent = `ETA: ${duration}`;
                stopButton.style.display = 'block';
              }
            });
          }
        });
      }

      document.getElementById('stopButton').addEventListener('click', () => {
        directionsRenderer.set('directions', null);
        etaDisplay.style.display = 'none';
        stopButton.style.display = 'none';
      });

      document.getElementById('recenterBtn').addEventListener('click', () => {
        if (userLatLng) {
          map.setCenter(userLatLng);
          centerOnUser = true;
        }
      });
    }

    window.initMap = initMap;
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNIMK5n09eQactHuhsqzZomcj-0Gyv_NA&libraries=places&callback=initMap"></script>
</body>
</html>
