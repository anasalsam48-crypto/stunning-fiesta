<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tesla Dashboard</title>
  <style>
    html, body, #map {
      margin: 0; padding: 0; height: 100%;
      font-family: sans-serif;
      background: #121212;
      color: white;
    }
    #map {
      width: 100vw;
      height: 100vh;
    }
    #destination-input {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1002;
      background: #222;
      padding: 8px 12px;
      border-radius: 6px;
      width: 320px;
      box-shadow: 0 0 10px #000;
    }
    #destination-input input {
      width: 100%;
      padding: 6px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
      color: black;
    }
    #searchResults {
      background: #111;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 4px;
      border-radius: 6px;
      color: white;
      box-shadow: 0 0 10px #000;
      display: none;
    }
    .search-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }
    .search-result:hover {
      background: #333;
    }
    .search-result button {
      background: #00FF00;
      border: none;
      color: #000;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }
    .search-result button:hover {
      background: #00cc00;
    }
    #etaDisplay {
      position: fixed;
      bottom: 60px;
      right: 20px;
      background: #222;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: monospace;
      display: none;
      z-index: 1001;
      color: #00ff00;
      font-weight: bold;
    }
    #bottom-buttons {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1001;
    }
    #bottom-buttons button {
      background: transparent;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #recenterBtn {
      position: fixed;
      bottom: 120px;
      right: 20px;
      z-index: 1001;
      background: #444;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="destination-input">
    <input id="destination" type="text" placeholder="Search destination..." autocomplete="off" />
    <div id="searchResults"></div>
  </div>

  <div id="etaDisplay">ETA:</div>
  <button id="recenterBtn">Recenter</button>

  <div id="bottom-buttons">
    <button>Home</button>
    <button>Music</button>
    <button>Navigation</button>
  </div>

  <script>
    let map, directionsService, directionsRenderer, userMarker;
    let userLocation = null;
    let resultsDiv;
    let service;

    function initMap() {
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        suppressMarkers: false,
        polylineOptions: {
          strokeColor: '#00FF00',
          strokeWeight: 5,
        },
      });

      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 14,
        styles: [
          { elementType: 'geometry', stylers: [{ color: '#1e1e1e' }] },
          { elementType: 'labels.text.fill', stylers: [{ color: '#ffffff' }] },
          { elementType: 'labels.text.stroke', stylers: [{ color: '#000000' }] },
          { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#2c2c2c' }] },
          { featureType: 'water', stylers: [{ color: '#0a0a0a' }] }
        ],
        disableDefaultUI: true,
      });

      directionsRenderer.setMap(map);
      resultsDiv = document.getElementById('searchResults');
      service = new google.maps.places.PlacesService(map);

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (pos) => {
            userLocation = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
            map.setCenter(userLocation);
            if (userMarker) {
              userMarker.setPosition(userLocation);
            } else {
              userMarker = new google.maps.Marker({
                position: userLocation,
                map,
                title: 'You are here',
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 8,
                  fillColor: '#00FF00',
                  fillOpacity: 1,
                  strokeWeight: 2,
                  strokeColor: '#ffffff',
                },
              });
            }
          },
          (err) => alert("Geolocation error: " + err.message),
          { enableHighAccuracy: true }
        );
      } else {
        alert('Geolocation not supported.');
      }

      setupSearch();
    }

    function setupSearch() {
      const input = document.getElementById('destination');

      input.addEventListener('input', () => {
        const query = input.value.trim();
        if (!query || !userLocation) {
          resultsDiv.innerHTML = '';
          resultsDiv.style.display = 'none';
          return;
        }

        service.textSearch({
          query: query,
          location: userLocation,
          radius: 10000,
        }, (results, status) => {
          if (status !== google.maps.places.PlacesServiceStatus.OK || !results.length) {
            resultsDiv.innerHTML = '<div style="padding:8px">No results</div>';
            resultsDiv.style.display = 'block';
            return;
          }

          results.sort((a, b) => {
            const distA = google.maps.geometry.spherical.computeDistanceBetween(userLocation, a.geometry.location);
            const distB = google.maps.geometry.spherical.computeDistanceBetween(userLocation, b.geometry.location);
            return distA - distB;
          });

          resultsDiv.innerHTML = '';
          results.forEach(place => {
            const div = document.createElement('div');
            div.className = 'search-result';

            const span = document.createElement('span');
            span.textContent = `${place.name} - ${place.formatted_address}`;

            const btn = document.createElement('button');
            btn.textContent = 'Go';
            btn.onclick = () => {
              routeTo(place.geometry.location);
              input.value = `${place.name} - ${place.formatted_address}`;
              resultsDiv.innerHTML = '';
              resultsDiv.style.display = 'none';
            };

            div.appendChild(span);
            div.appendChild(btn);
            resultsDiv.appendChild(div);
          });
          resultsDiv.style.display = 'block';
        });
      });

      // Pressing Enter triggers first result
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const firstBtn = resultsDiv.querySelector('button');
          if (firstBtn) firstBtn.click();
        }
      });

      // Clicking outside closes results
      document.addEventListener('click', (e) => {
        if (!document.getElementById('destination-input').contains(e.target)) {
          resultsDiv.style.display = 'none';
        }
      });

      // Recenter button
      document.getElementById('recenterBtn').addEventListener('click', () => {
        if (userLocation) map.setCenter(userLocation);
      });
    }

    function routeTo(destination) {
      if (!userLocation) {
        alert('Waiting for your location...');
        return;
      }
      directionsService.route(
        {
          origin: userLocation,
          destination: destination,
          travelMode: google.maps.TravelMode.DRIVING,
        },
        (response, status) => {
          if (status === 'OK') {
            directionsRenderer.setDirections(response);
            const leg = response.routes[0].legs[0];
            const etaDiv = document.getElementById('etaDisplay');
            etaDiv.innerText = `ETA: ${leg.duration.text}`;
            etaDiv.style.display = 'block';
          } else {
            alert('Directions request failed: ' + status);
          }
        }
      );
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNIMK5n09eQactHuhsqzZomcj-0Gyv_NA&libraries=places,geometry&callback=initMap" async defer></script>
</body>
</html>
